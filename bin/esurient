#!/usr/bin/env bash

#######################################################
# An example runner script for use with the fat jar
# produced by bin/build. Must be executed from a host
# with a Hadoop client installed at HADOOP_HOME and the
# *-site.xml files in HADOOP_CONF_DIR.


function green() {
  echo -e "\x1B[32m"
}

function white() {
  echo -e "\x1B[37m"
}

function off() {
  echo -e "\x1B[0m"
}

function runJob() {
  green
  echo '[*] '
  white
  echo "Esurient Job Executing with args: $@"
  off
  HADOOP_CLASSPATH=`hadoop classpath` hadoop jar $JARPATH com.ereisman.esurient.hadoop.EsurientTool $@
  green
  echo '[*] '
  white
  echo 'Esurient job completed.'
  off
  echo
  echo
  exit 0
}

function usage() {
  green
  echo '[*] '
  white
  echo "Usage:"
  echo "    $0 [-h|--help]"
  echo "    $0 [/path/to/esurient.jar] [arg1] [arg2] ..."
  off
  echo
  exit 1
}

# Assumes we're executing from the bin/ dir. finds repo root dir
pushd ../$(dirname $0) >/dev/null
BASEDIR=`pwd -P`
popd

# Default if the user didn't provide a path to the fat jar
JARPATH="$BASEDIR/target/esurient-1.0-SNAPSHOT-jar-with-dependencies.jar" 
if [ -n $1 ] ; then
  JARPATH = $1
  shift
fi

if [[ "$JARPATH" == '-h' || "$JARPATH" == '--help' ]] ; then
  usage
else
  runJob
fi
